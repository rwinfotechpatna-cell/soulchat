<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SoulByRohit - Global Cinematic Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@200;300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js" type="module"></script>

    <style>
        :root {
            --bg-deep: #050203;
            --rose-gold: #e2b4bd;
            --text-white: #fff5f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; background-color: var(--bg-deep); font-family: 'Montserrat', sans-serif; color: var(--text-white); }

        #setup-ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: var(--bg-deep); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .input-card { background: rgba(255, 255, 255, 0.03); padding: 40px; border-radius: 20px; border: 1px solid var(--rose-gold); width: 100%; max-width: 400px; text-align: center; backdrop-filter: blur(10px); }
        h2 { font-family: 'Playfair Display', serif; color: var(--rose-gold); margin-bottom: 20px; letter-spacing: 2px; }
        input#user-name { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; outline: none; text-align: center; }
        .btn { background: var(--rose-gold); color: black; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: 600; }

        #sidebar { position: fixed; top: 20px; left: 20px; z-index: 150; width: 220px; height: calc(100vh - 120px); display: none; flex-direction: column; gap: 20px; }
        .section-box { background: rgba(255,255,255,0.02); backdrop-filter: blur(10px); border-radius: 15px; border: 1px solid rgba(226,180,189,0.1); padding: 15px; overflow-y: auto; flex: 1; }
        .sidebar-title { font-size: 0.6rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 12px; color: var(--rose-gold); font-weight: 700; }
        .user-item { padding: 10px; margin-bottom: 5px; border-radius: 8px; font-size: 0.8rem; background: rgba(255,255,255,0.03); display: flex; align-items: center; gap: 8px; }
        .status-dot { width: 7px; height: 7px; border-radius: 50%; background: #4ade80; box-shadow: 0 0 5px #4ade80; }

        #chat-display { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 10; pointer-events: none; }
        .cinematic-box { position: absolute; text-align: center; width: 80%; animation: cinematicIn 7s ease-out forwards; }
        @keyframes cinematicIn {
            0% { opacity: 0; transform: scale(0.9) translateY(20px); filter: blur(10px); }
            15% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
            85% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
            100% { opacity: 0; transform: scale(1.1) translateY(-20px); filter: blur(10px); }
        }
        .msg-text { font-family: 'Playfair Display', serif; font-size: clamp(1.5rem, 5vw, 2.5rem); font-style: italic; }

        #input-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; z-index: 100; display: none; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 50px; border: 1px solid rgba(226,180,189,0.2); backdrop-filter: blur(15px); }
        #msg-input { flex: 1; background: transparent; border: none; color: white; padding: 10px; outline: none; }
        
        #canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
    </style>
</head>
<body>

    <div id="setup-ui">
        <div class="input-card">
            <h2>SOUL CONNECT</h2>
            <p id="status-msg" style="font-size: 0.7rem; margin-bottom: 10px; opacity: 0.6;">Duniya se judne ke liye taiyaar...</p>
            <input type="text" id="user-name" placeholder="Apna Naam Likhein...">
            <button class="btn" onclick="joinChat()">Start Session</button>
        </div>
    </div>

    <div id="sidebar">
        <div class="section-box">
            <div class="sidebar-title">Online Now</div>
            <div id="online-list"></div>
        </div>
    </div>

    <canvas id="canvas"></canvas>
    <div id="chat-display"></div>

    <div id="input-bar">
        <input type="text" id="msg-input" placeholder="Yahan likhein..." maxlength="100">
        <button class="btn" style="padding: 10px 20px;" onclick="sendMessage()">Bhejein</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- STEP: FIREBASE CONSOLE CONFIG APPLIED ---
        const firebaseConfig = {
            apiKey: "AIzaSyAX4TWE46VMW0l6QzfAgPFqluvXhbOxzUo",
            authDomain: "mycinematicchat.firebaseapp.com",
            projectId: "mycinematicchat",
            storageBucket: "mycinematicchat.firebasestorage.app",
            messagingSenderId: "982781079010",
            appId: "1:982781079010:web:4a68ac4a70e81655599dbb",
            measurementId: "G-9VV25X3PS5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "global-cinematic-v1";

        let myName = "";

        window.joinChat = async () => {
            myName = document.getElementById('user-name').value.trim();
            if(!myName) return;

            document.getElementById('setup-ui').style.display = 'none';
            document.getElementById('input-bar').style.display = 'flex';
            document.getElementById('sidebar').style.display = 'flex';

            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Auth Error:", error);
                alert("Firebase Authentication इनेबल करें (Anonymous)!");
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user && myName) {
                const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'online_users', user.uid);
                setDoc(userRef, { name: myName, uid: user.uid, lastSeen: serverTimestamp() }, { merge: true });

                onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'online_users')), (snap) => {
                    const list = document.getElementById('online-list');
                    list.innerHTML = '';
                    snap.forEach(d => {
                        const u = d.data();
                        list.innerHTML += `<div class="user-item"><div class="status-dot"></div> ${u.name}</div>`;
                    });
                });

                onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'messages')), (snap) => {
                    snap.docChanges().forEach(change => {
                        if (change.type === "added") {
                            const data = change.doc.data();
                            if(data.createdAt) showCinematic(data);
                        }
                    });
                });
            }
        });

        window.sendMessage = async () => {
            const input = document.getElementById('msg-input');
            if(!input.value.trim()) return;
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), {
                    text: input.value, sender: myName, createdAt: serverTimestamp()
                });
                input.value = '';
            } catch (error) {
                console.error("Firestore Error:", error);
                alert("Firestore Rules अपडेट करें!");
            }
        };

        function showCinematic(data) {
            const box = document.createElement('div');
            box.className = 'cinematic-box';
            box.innerHTML = `<div style="font-size:0.6rem; letter-spacing:3px; color:var(--rose-gold)">${data.sender.toUpperCase()} BOLA...</div>
                             <div class="msg-text">${data.text}</div>`;
            document.getElementById('chat-display').appendChild(box);
            setTimeout(() => box.remove(), 7000);
        }

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        function draw() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; ctx.fillStyle = '#050203'; ctx.fillRect(0,0,canvas.width,canvas.height); }
        window.addEventListener('resize', draw); draw();
    </script>
</body>
</html>
